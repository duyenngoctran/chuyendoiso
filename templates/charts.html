<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bi·ªÉu ƒë·ªì ph√¢n t√≠ch</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{background:#f7f7fb}
    .card{border:0;border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.06)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px}
  </style>
</head>
<body>
<div class="container py-5">
  <div class="d-flex align-items-center mb-4">
    <h3 class="mb-0">üìà Bi·ªÉu ƒë·ªì ph√¢n t√≠ch</h3>
    <div class="ms-auto">
      <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">‚Üê Trang ch√≠nh</a>
      <a href="{{ url_for('insights') }}" class="btn btn-outline-info ms-2">
  Xem chi ti·∫øt ‚Üí</a>

    </div>
  </div>

  {% set s = stats or {} %}
  <div class="row g-4 mb-3">
    <div class="col-md-3"><div class="card p-4 h-100"><div class="text-muted">T·ªïng b√¨nh lu·∫≠n</div><div class="fs-3 fw-bold">{{ s.total|default(0, true) }}</div></div></div>
    <div class="col-md-3"><div class="card p-4 h-100"><div class="text-muted">T√≠ch c·ª±c</div><div class="fs-3 fw-bold text-success">{{ s.pos|default(0, true) }}</div><div class="text-muted">{{ '%.2f'|format(s.pos_pct|default(0, true)) }}%</div></div></div>
    <div class="col-md-3"><div class="card p-4 h-100"><div class="text-muted">Ti√™u c·ª±c</div><div class="fs-3 fw-bold text-danger">{{ s.neg|default(0, true) }}</div><div class="text-muted">{{ '%.2f'|format(s.neg_pct|default(0, true)) }}%</div></div></div>
  </div>

  <div class="grid">
    <div class="card p-4">
      <h6 class="mb-3">Bi·ªÉu ƒë·ªì tr√≤n</h6>
      <canvas id="pie"></canvas>
    </div>
    <div class="card p-4">
      <h6 class="mb-3">Bi·ªÉu ƒë·ªì c·ªôt</h6>
      <canvas id="bar"></canvas>
    </div>
    <div class="card p-4">
      <h6 class="mb-3">T·ª∑ l·ªá (%) ‚Äì doughnut</h6>
      <canvas id="doughnut"></canvas>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const stats = {{ {
    "pos": s.pos|default(0, true),
    "neg": s.neg|default(0, true),
    "pos_pct": s.pos_pct|default(0, true),
    "neg_pct": s.neg_pct|default(0, true)
  } | tojson }};

  const labels = ['T√≠ch c·ª±c', 'Ti√™u c·ª±c'];
  const qty = [stats.pos, stats.neg];
  const pct = [stats.pos_pct, stats.neg_pct];
  const bg = ['#22c55e','#ef4444'];
  const bd = ['#16a34a','#dc2626'];

  new Chart(document.getElementById('pie'), {
    type: 'pie',
    data: { labels, datasets: [{ data: qty, backgroundColor: bg, borderColor: bd, borderWidth: 1 }]},
    options: { plugins: { legend: { position: 'bottom' } } }
  });

  new Chart(document.getElementById('bar'), {
    type: 'bar',
    data: { labels, datasets: [{ label: 'S·ªë l∆∞·ª£ng', data: qty, backgroundColor: bg, borderColor: bd, borderWidth: 1 }]},
    options: { plugins: { legend: { display:false } }, scales: { y: { beginAtZero:true, ticks:{ stepSize:1 }}}}
  });

  new Chart(document.getElementById('doughnut'), {
    type: 'doughnut',
    data: { labels: ['% t√≠ch c·ª±c','% ti√™u c·ª±c'], datasets: [{ data: pct, backgroundColor: bg, borderColor: bd, borderWidth: 1 }]},
    options: { plugins: { legend: { position: 'bottom' } } }
  });
});
</script>

<script>
if (typeof window.Chart === 'undefined') {
  var s = document.createElement('script');
  s.src = 'https://unpkg.com/chart.js@4.4.4/dist/chart.umd.min.js';
  document.head.appendChild(s);
}
</script>


</body>
</html>
